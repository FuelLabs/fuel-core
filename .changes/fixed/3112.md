Use Protobuf types in serialization rather than opaque bytes